<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(getData);

  function plot(data) {
    var dataTable = new google.visualization.DataTable();
    dataTable.addColumn('string', 'Hyperlink');
    dataTable.addColumn('string', 'Style');
    dataTable.addColumn('number', 'Church buildings');
    var lines = data.split(/\r\n|\n/);
    for (var i = 1; i < lines.length; i++) { //skip the first line containing the column labels
      data = lines[i].split(',');
      row = [data[0], data[1], parseInt(data[2])];
      dataTable.addRow(row);
    }
    var view = new google.visualization.DataView(dataTable);
    view.setColumns([0, 2]);
    
    var options = {'title':'Church buildings by current function'
    ,'width':1000
    ,'height':600
    ,'legend':'left'
    ,'is3D':true
    };
    var chart = new google.visualization.PieChart(document.getElementById('chart'));
    chart.draw(view, options);
    var selectHandler = function(e) {
      window.open(dataTable.getValue(chart.getSelection()[0]['row'],1))
    }
    google.visualization.events.addListener(chart, 'select', selectHandler);
  }
  
  function getData() {
    //The following SPARQL query is URL encoded. The query can be URL decoded to view it in a more readable way.
    sparql='http://data.spider-ld.org/marmotta/sparql/select?query=prefix%20dbo%3A%20%3Chttp%3A%2F%2Fdbpedia.org%2Fontology%2F%3E%0Aselect%20%3Flabel%20%3Fstyle%20(count(%3Fchurch)%20as%20%3Fnumber_of_churches)%0Awhere%20%7B%0A%20%20%3Fchurch%20a%20dbo%3AChurch%20.%0A%20%20%3Fchurch%20dbo%3AarchitecturalStyle%20%3Fstyle%20.%0A%20%20filter(regex(str(%3Fstyle)%2C%20%22dbpedia%22))%20.%0A%20%20bind%20(%3Fstyle%20as%20%3Flabel)%20.%0A%7D%0Agroup%20by%20%3Fstyle%20%3Flabel'
    
    var xhr = new XMLHttpRequest();
    var csv;
    xhr.onreadystatechange = function() {
      if (xhr.readyState == XMLHttpRequest.DONE) {
        plot(xhr.responseText);
      }
    }
    xhr.open('GET', sparql, true);
    xhr.setRequestHeader("Accept", "text/csv"); 
    xhr.send(null);
  }
  </script>
</head>

<body>
<p>Click on the diagram or the legend to open the linked data in a new tab.</p>
<div id="chart"></div>
</body>
</html>